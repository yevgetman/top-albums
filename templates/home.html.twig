{% extends 'base.html.twig' %}
{% block view %}

    <style type="text/css">
        .key-wrap,
        .error,
        #hiddenInput,
        #clipboard-message {
            display: none;
        }
        .error {
            font-size: 20px;
        }
        .key-wrap .key {
            font-size: 30px;
        }
        .key-wrap svg {
            height: 40px;
            cursor: pointer;
            margin-left: 20px;
        }
        .key-wrap div {
            display: flex;
            align-items: center;
        }
        #clipboard-message {
            font-size: 17px;
            color: #4accb4;
        }
    </style>
        
    <div class="content my30">
        
        <button id="get-key" class="btn">Genereate API key</button>

        <div class="key-wrap px5 ptop30">
            <h5>Your API key:</h5>
            <div>
                <div class="key mtop10" >&nsbp;</div>
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
                <path style="fill:#4A5A67;" d="M0,256.006C0,397.402,114.606,512.004,255.996,512C397.394,512.004,512,397.402,512,256.006
                    C512.009,114.61,397.394,0,255.996,0C114.606,0,0,114.614,0,256.006z"/>
                <path style="fill:#444A54;" d="M509.065,294.886L304.099,89.921c-0.771-0.772-1.694-1.389-2.717-1.817
                    c-1.019-0.426-2.119-0.655-3.245-0.655H163.297c-4.654,0-8.428,3.774-8.428,8.427v25.282h-25.282c-4.654,0-8.427,3.774-8.427,8.428
                    v286.536c0,2.759,1.414,5.093,3.465,6.63c0.482,0.642,82.769,82.93,83.411,83.411c0.452,0.603,0.973,1.105,1.565,1.565
                    c15.055,2.756,30.544,4.272,46.395,4.271C384.176,512.003,490.335,417.827,509.065,294.886z"/>
                <path style="fill:#F4F6F9;" d="M390.185,176.908c-0.428-1.023-1.044-1.946-1.817-2.717l-84.27-84.27
                    c-0.771-0.772-1.694-1.389-2.717-1.817c-1.019-0.426-2.119-0.655-3.245-0.655H163.297c-4.654,0-8.428,3.774-8.428,8.428v25.282
                    h-25.282c-4.654,0-8.428,3.774-8.428,8.428v286.535c0,4.654,3.774,8.428,8.428,8.428h219.116c4.654,0,8.428-3.774,8.428-8.428
                    v-25.282h25.282c4.654,0,8.428-3.774,8.428-8.428v-202.26C390.841,179.027,390.611,177.926,390.185,176.908z M306.565,116.222
                    l55.503,55.503h-55.503V116.222z M340.275,407.695h-202.26v-269.68h16.855v244.398c0,4.654,3.774,8.428,8.428,8.428h176.978v16.854
                    H340.275z M171.725,373.985v-269.68H289.71v75.847c0,4.654,3.774,8.428,8.428,8.428h75.847v185.405L171.725,373.985L171.725,373.985
                    z"/>
                </svg>
            </div>

        </div>

        <div id="clipboard-message" class="px7">Copied to clipboard!</div>

        <input type="text" value="" id="hiddenInput">

        <div class="error px7 py30">&nbsp;</div>

    </div>

    <script type="text/javascript" >

        document.getElementById('get-key').addEventListener('click',function(){

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/get-key', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');
            xhr.onload = function() {

              if(this.status >= 200) {
                
                const resp = JSON.parse(this.response);

                if(resp.response.status < 0){

                    document.querySelector('.error').innerHTML = resp.response.error[0];
                    document.querySelector('.error').style.display = 'block';

                } else { // succcess

                    document.querySelector('.key-wrap .key').innerHTML = resp.data.key;
                    document.getElementById('hiddenInput').value = resp.data.key;
                    document.querySelector('.key-wrap').style.display = 'block';
                }

                setTimeout(function(){
                    document.querySelector('.key-wrap').style.display = 'none';
                },20000);
              
              }

            };            
            xhr.send();
        });

        document.querySelector('.key-wrap svg').addEventListener('click',function(){

            const key = document.getElementById('hiddenInput');
            key.select();
            key.setSelectionRange(0, 99999); // For mobile devices
            navigator.clipboard.writeText(key.value);
            document.getElementById('clipboard-message').style.display = 'block';
            setTimeout(function(){
                document.getElementById('clipboard-message').style.display = 'none';
            },3000);
        });

    </script>

{% endblock %}